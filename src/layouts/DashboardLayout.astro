---
import BaseHead from '@components/BaseHead.astro'
import AppLogo from '@components/AppLogo.astro'
import UserBadge from '@components/UserBadge.astro'
import Navigation from '@components/Navigation.astro'
import ToggleTheme from '@components/theme/ToggleTheme.astro'
import MiniFooter from '@components/MiniFooter.astro'
import { Toaster } from 'svelte-sonner'
import { isAdmin, isTeacher } from '@lib/auth'
import TopLoader from '@components/TopLoader.svelte'

const { metadata = {} } = Astro.props
const user = Astro.locals.user
---

<html lang="es">
  <head>
    <BaseHead metadata={metadata} />
  </head>
  <body>
    <TopLoader client:load />
    <header class="header">
      <AppLogo />
      <Navigation>
        <ul class="menu">
          {
            user && (
              <li class="menu__item">
                <a
                  class:list={[
                    'menu__link',
                    {
                      'menu__link--active':
                        Astro.url.pathname === '/dashboard' ||
                        Astro.url.pathname === '/dashboard/',
                    },
                  ]}
                  href="/dashboard"
                >
                  Dashboard
                </a>
              </li>
            )
          }

          {
            user && isTeacher(user) && (
              <li class="menu__item">
                <a
                  class:list={[
                    'menu__link',
                    {
                      'menu__link--active':
                        Astro.url.pathname.startsWith('/dashboard/docente'),
                    },
                  ]}
                  href="/dashboard/docente"
                >
                  Docente
                </a>
              </li>
            )
          }

          {
            user && isAdmin(user) && (
              <li class="menu__item">
                <a
                  class:list={[
                    'menu__link',
                    {
                      'menu__link--active':
                        Astro.url.pathname.startsWith('/admin'),
                    },
                  ]}
                  href="/dashboard/admin"
                >
                  Admin
                </a>
              </li>
            )
          }
        </ul>

        <Fragment slot="actions">
          <UserBadge />
          <ToggleTheme />
        </Fragment>
      </Navigation>
    </header>

    <main class="main">
      <slot />
    </main>

    <Toaster client:load />

    <MiniFooter />
  </body>
</html>

<style>
  .header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0.75rem 2rem;
    gap: 1rem;
    flex-wrap: wrap;
  }

  .menu {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    height: 100%;
    font-weight: bold;
    list-style: none;
    margin-top: 0;
    margin-bottom: 0;
    padding-left: 0;
  }

  @media screen and (max-width: 768px) {
    .menu {
      flex-direction: column;
      gap: 1.5rem;
      font-size: 1.75rem;
    }
  }

  .menu__link {
    padding: 0.375rem 0.75rem;
    border-radius: 0.375rem;
    font-size: 0.875em;
    font-weight: 600;
    color: var(--text-color-secondary);
    transition:
      background-color 0.2s,
      color 0.2s;
  }

  .menu__link:hover {
    background-color: rgba(128, 128, 128, 0.1);
    color: var(--text-color-primary);
  }

  .menu__link--active {
    background-color: rgba(17, 107, 177, 0.1);
    color: var(--brand-primary);
  }

  .main {
    max-width: var(--page-max-width);
    margin: 0 auto;
    width: 100%;
    padding: 1rem 0.5rem;
    min-height: calc(100vh - 8rem);
  }

  @media screen and (min-width: 25rem) {
    .main {
      padding: 2rem 1.5rem;
    }
  }

  @media screen and (min-width: 37.5rem) {
    .main {
      padding: 2rem;
    }
  }

  @media screen and (max-width: 37.5rem) {
    .header {
      padding: 0.75rem 1rem;
    }
  }
</style>
